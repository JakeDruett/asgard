"""
GraphQL schema demonstrating complex type features including:
- Nested types with deep hierarchies
- Interfaces and implementation
- Union types
- Abstract types
- Recursive types
"""

scalar DateTime
scalar JSON

# Interfaces
interface Node {
  id: ID!
}

interface Timestamped {
  createdAt: DateTime!
  updatedAt: DateTime!
}

interface Auditable {
  createdBy: User
  updatedBy: User
  createdAt: DateTime!
  updatedAt: DateTime!
}

interface Searchable {
  searchableText: String!
  searchScore: Float
}

interface Publishable {
  publishedAt: DateTime
  isPublished: Boolean!
  publishedBy: User
}

# Complex nested types
type Organization implements Node & Timestamped {
  id: ID!
  name: String!
  slug: String!
  description: String
  logo: Media
  settings: OrganizationSettings!
  departments: [Department!]!
  members: [OrganizationMember!]!
  projects: [Project!]!
  billingInfo: BillingInfo
  subscription: Subscription
  auditLog(limit: Int = 50): [AuditEntry!]!
  createdAt: DateTime!
  updatedAt: DateTime!
}

type OrganizationSettings {
  timezone: String!
  locale: String!
  dateFormat: String!
  features: FeatureFlags!
  integrations: [Integration!]!
  notifications: NotificationSettings!
  security: SecuritySettings!
}

type FeatureFlags {
  advancedAnalytics: Boolean!
  customBranding: Boolean!
  ssoEnabled: Boolean!
  apiAccess: Boolean!
  webhooks: Boolean!
  customFields: Boolean!
}

type Integration {
  id: ID!
  type: IntegrationType!
  name: String!
  config: JSON
  isActive: Boolean!
  lastSyncedAt: DateTime
  syncStatus: SyncStatus
}

enum IntegrationType {
  SLACK
  JIRA
  GITHUB
  GITLAB
  TRELLO
  ASANA
  CUSTOM_WEBHOOK
}

enum SyncStatus {
  SYNCED
  SYNCING
  FAILED
  PENDING
}

type NotificationSettings {
  emailEnabled: Boolean!
  slackEnabled: Boolean!
  digestFrequency: DigestFrequency!
  channels: [NotificationChannel!]!
}

enum DigestFrequency {
  REAL_TIME
  HOURLY
  DAILY
  WEEKLY
  NEVER
}

type NotificationChannel {
  type: String!
  destination: String!
  events: [String!]!
  isActive: Boolean!
}

type SecuritySettings {
  mfaRequired: Boolean!
  sessionTimeout: Int!
  ipWhitelist: [String!]
  passwordPolicy: PasswordPolicy!
}

type PasswordPolicy {
  minLength: Int!
  requireUppercase: Boolean!
  requireLowercase: Boolean!
  requireNumbers: Boolean!
  requireSpecialChars: Boolean!
  maxAge: Int
  preventReuse: Int
}

type Department implements Node {
  id: ID!
  name: String!
  description: String
  organization: Organization!
  parent: Department
  children: [Department!]!
  manager: User
  members: [User!]!
  projects: [Project!]!
  budget: Budget
  path: [Department!]!
  depth: Int!
}

type Budget {
  allocated: Float!
  spent: Float!
  remaining: Float!
  currency: String!
  period: BudgetPeriod!
  categories: [BudgetCategory!]!
}

type BudgetCategory {
  name: String!
  allocated: Float!
  spent: Float!
}

enum BudgetPeriod {
  MONTHLY
  QUARTERLY
  YEARLY
}

type OrganizationMember {
  user: User!
  organization: Organization!
  role: OrganizationRole!
  department: Department
  permissions: [Permission!]!
  joinedAt: DateTime!
  invitedBy: User
}

enum OrganizationRole {
  OWNER
  ADMIN
  MEMBER
  VIEWER
  GUEST
}

type Permission {
  resource: String!
  actions: [String!]!
  conditions: JSON
}

type User implements Node & Timestamped & Searchable {
  id: ID!
  email: String!
  name: String!
  avatar: Media
  bio: String
  timezone: String
  locale: String
  organizations: [OrganizationMember!]!
  tasks: TaskConnection!
  activity(limit: Int = 20): [Activity!]!
  notifications(unreadOnly: Boolean = false): [Notification!]!
  preferences: UserPreferences!
  searchableText: String!
  searchScore: Float
  createdAt: DateTime!
  updatedAt: DateTime!
}

type UserPreferences {
  theme: Theme!
  emailNotifications: Boolean!
  pushNotifications: Boolean!
  weekStartsOn: DayOfWeek!
  defaultView: ViewType!
}

enum Theme {
  LIGHT
  DARK
  SYSTEM
}

enum DayOfWeek {
  SUNDAY
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
}

enum ViewType {
  LIST
  BOARD
  CALENDAR
  TIMELINE
}

type Project implements Node & Timestamped & Auditable & Searchable {
  id: ID!
  name: String!
  key: String!
  description: String
  organization: Organization!
  department: Department
  owner: User!
  members: [ProjectMember!]!
  status: ProjectStatus!
  visibility: Visibility!
  settings: ProjectSettings!
  milestones: [Milestone!]!
  tasks(filter: TaskFilter): TaskConnection!
  documents: [Document!]!
  labels: [Label!]!
  customFields: [CustomField!]!
  statistics: ProjectStatistics!
  createdBy: User
  updatedBy: User
  searchableText: String!
  searchScore: Float
  createdAt: DateTime!
  updatedAt: DateTime!
}

enum ProjectStatus {
  PLANNING
  ACTIVE
  ON_HOLD
  COMPLETED
  ARCHIVED
}

enum Visibility {
  PUBLIC
  PRIVATE
  INTERNAL
}

type ProjectSettings {
  defaultTaskType: TaskType!
  workflowStates: [WorkflowState!]!
  priorities: [Priority!]!
  estimationMethod: EstimationMethod!
  timeTracking: Boolean!
}

type WorkflowState {
  id: ID!
  name: String!
  color: String!
  category: StateCategory!
  order: Int!
}

enum StateCategory {
  TODO
  IN_PROGRESS
  DONE
  CANCELLED
}

type Priority {
  id: ID!
  name: String!
  color: String!
  order: Int!
}

enum EstimationMethod {
  HOURS
  STORY_POINTS
  T_SHIRT_SIZES
  NONE
}

type ProjectMember {
  user: User!
  project: Project!
  role: ProjectRole!
  permissions: [Permission!]!
  joinedAt: DateTime!
}

enum ProjectRole {
  OWNER
  ADMIN
  MEMBER
  VIEWER
}

type ProjectStatistics {
  taskCount: Int!
  completedTaskCount: Int!
  overdueTaskCount: Int!
  memberCount: Int!
  completionRate: Float!
  averageTaskDuration: Float
  burndownData: [BurndownPoint!]!
}

type BurndownPoint {
  date: DateTime!
  remaining: Int!
  completed: Int!
  ideal: Int!
}

type Milestone implements Node & Timestamped {
  id: ID!
  name: String!
  description: String
  project: Project!
  dueDate: DateTime
  status: MilestoneStatus!
  tasks: [Task!]!
  progress: Float!
  createdAt: DateTime!
  updatedAt: DateTime!
}

enum MilestoneStatus {
  OPEN
  CLOSED
}

# Union types for polymorphic content
union SearchResult = User | Project | Task | Document

union ActivityTarget = Task | Project | Milestone | Comment | Document

union NotificationContent = TaskNotification | MentionNotification | CommentNotification | SystemNotification

type Task implements Node & Timestamped & Auditable & Searchable {
  id: ID!
  key: String!
  title: String!
  description: String
  project: Project!
  type: TaskType!
  status: WorkflowState!
  priority: Priority
  assignee: User
  reporter: User!
  watchers: [User!]!
  parent: Task
  subtasks: [Task!]!
  blockedBy: [Task!]!
  blocks: [Task!]!
  labels: [Label!]!
  milestone: Milestone
  dueDate: DateTime
  estimatedTime: Float
  loggedTime: Float
  attachments: [Attachment!]!
  comments: [Comment!]!
  customFieldValues: [CustomFieldValue!]!
  history: [TaskHistoryEntry!]!
  createdBy: User
  updatedBy: User
  searchableText: String!
  searchScore: Float
  createdAt: DateTime!
  updatedAt: DateTime!
}

enum TaskType {
  TASK
  BUG
  STORY
  EPIC
  SUBTASK
}

type Label implements Node {
  id: ID!
  name: String!
  color: String!
  description: String
  project: Project!
  taskCount: Int!
}

type CustomField implements Node {
  id: ID!
  name: String!
  type: CustomFieldType!
  options: [String!]
  isRequired: Boolean!
  project: Project!
}

enum CustomFieldType {
  TEXT
  NUMBER
  DATE
  SELECT
  MULTI_SELECT
  USER
  URL
}

type CustomFieldValue {
  field: CustomField!
  value: String
  values: [String!]
}

type Comment implements Node & Timestamped {
  id: ID!
  body: String!
  author: User!
  task: Task!
  parent: Comment
  replies: [Comment!]!
  mentions: [User!]!
  reactions: [Reaction!]!
  isEdited: Boolean!
  createdAt: DateTime!
  updatedAt: DateTime!
}

type Reaction {
  emoji: String!
  users: [User!]!
  count: Int!
}

type Document implements Node & Timestamped & Auditable & Publishable & Searchable {
  id: ID!
  title: String!
  content: String!
  project: Project!
  folder: DocumentFolder
  author: User!
  collaborators: [User!]!
  version: Int!
  versions: [DocumentVersion!]!
  attachments: [Attachment!]!
  publishedAt: DateTime
  isPublished: Boolean!
  publishedBy: User
  createdBy: User
  updatedBy: User
  searchableText: String!
  searchScore: Float
  createdAt: DateTime!
  updatedAt: DateTime!
}

type DocumentFolder implements Node {
  id: ID!
  name: String!
  parent: DocumentFolder
  children: [DocumentFolder!]!
  documents: [Document!]!
  path: [DocumentFolder!]!
}

type DocumentVersion {
  version: Int!
  content: String!
  author: User!
  createdAt: DateTime!
  changeDescription: String
}

type Attachment implements Node {
  id: ID!
  filename: String!
  mimeType: String!
  size: Int!
  url: String!
  thumbnail: String
  uploadedBy: User!
  uploadedAt: DateTime!
}

type Media implements Node {
  id: ID!
  url: String!
  thumbnailUrl: String
  mimeType: String!
  size: Int!
  width: Int
  height: Int
  alt: String
  caption: String
}

type Activity implements Node {
  id: ID!
  type: ActivityType!
  actor: User!
  target: ActivityTarget!
  targetType: String!
  action: String!
  changes: JSON
  metadata: JSON
  occurredAt: DateTime!
}

enum ActivityType {
  CREATE
  UPDATE
  DELETE
  COMMENT
  ASSIGN
  STATUS_CHANGE
  MENTION
}

type AuditEntry implements Node {
  id: ID!
  action: String!
  resource: String!
  resourceId: ID!
  actor: User
  ipAddress: String
  userAgent: String
  changes: JSON
  occurredAt: DateTime!
}

# Notification types (implementing union)
interface BaseNotification {
  id: ID!
  recipient: User!
  isRead: Boolean!
  createdAt: DateTime!
}

type TaskNotification implements BaseNotification & Node {
  id: ID!
  recipient: User!
  isRead: Boolean!
  task: Task!
  action: String!
  actor: User!
  createdAt: DateTime!
}

type MentionNotification implements BaseNotification & Node {
  id: ID!
  recipient: User!
  isRead: Boolean!
  mentionedIn: String!
  mentionedBy: User!
  context: String!
  createdAt: DateTime!
}

type CommentNotification implements BaseNotification & Node {
  id: ID!
  recipient: User!
  isRead: Boolean!
  comment: Comment!
  task: Task!
  createdAt: DateTime!
}

type SystemNotification implements BaseNotification & Node {
  id: ID!
  recipient: User!
  isRead: Boolean!
  title: String!
  message: String!
  priority: NotificationPriority!
  createdAt: DateTime!
}

enum NotificationPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

type Notification {
  id: ID!
  content: NotificationContent!
  isRead: Boolean!
  createdAt: DateTime!
}

type BillingInfo {
  plan: String!
  status: String!
  seats: Int!
  usedSeats: Int!
  billingEmail: String!
  nextBillingDate: DateTime
  paymentMethod: PaymentMethod
}

type PaymentMethod {
  type: String!
  last4: String
  expiryMonth: Int
  expiryYear: Int
}

type Subscription {
  id: ID!
  plan: SubscriptionPlan!
  status: SubscriptionStatus!
  currentPeriodStart: DateTime!
  currentPeriodEnd: DateTime!
  cancelAtPeriodEnd: Boolean!
}

type SubscriptionPlan {
  id: ID!
  name: String!
  price: Float!
  interval: BillingInterval!
  features: [String!]!
}

enum BillingInterval {
  MONTHLY
  YEARLY
}

enum SubscriptionStatus {
  ACTIVE
  PAST_DUE
  CANCELED
  TRIALING
}

# Connection types
type TaskConnection {
  edges: [TaskEdge!]!
  pageInfo: PageInfo!
  totalCount: Int!
}

type TaskEdge {
  node: Task!
  cursor: String!
}

type PageInfo {
  hasNextPage: Boolean!
  hasPreviousPage: Boolean!
  startCursor: String
  endCursor: String
}

input TaskFilter {
  status: [ID!]
  priority: [ID!]
  assignee: [ID!]
  type: [TaskType!]
  labels: [ID!]
  milestone: ID
  dueAfter: DateTime
  dueBefore: DateTime
  search: String
}

type TaskHistoryEntry {
  id: ID!
  field: String!
  oldValue: String
  newValue: String
  changedBy: User!
  changedAt: DateTime!
}

# Root types
type Query {
  node(id: ID!): Node
  viewer: User
  organization(id: ID!): Organization
  project(id: ID!): Project
  task(id: ID!): Task
  search(query: String!, types: [String!], limit: Int = 20): [SearchResult!]!
}

type Mutation {
  createProject(input: CreateProjectInput!): Project!
  createTask(input: CreateTaskInput!): Task!
  updateTask(id: ID!, input: UpdateTaskInput!): Task!
  addComment(taskId: ID!, body: String!, parentId: ID): Comment!
}

input CreateProjectInput {
  name: String!
  key: String!
  description: String
  organizationId: ID!
  visibility: Visibility = PRIVATE
}

input CreateTaskInput {
  projectId: ID!
  title: String!
  description: String
  type: TaskType = TASK
  priorityId: ID
  assigneeId: ID
  milestoneId: ID
  parentId: ID
  labels: [ID!]
}

input UpdateTaskInput {
  title: String
  description: String
  statusId: ID
  priorityId: ID
  assigneeId: ID
  milestoneId: ID
  dueDate: DateTime
  labels: [ID!]
}

type Subscription {
  taskUpdated(projectId: ID!): Task!
  commentAdded(taskId: ID!): Comment!
  notificationReceived: Notification!
}

schema {
  query: Query
  mutation: Mutation
  subscription: Subscription
}
